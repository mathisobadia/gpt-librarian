import { createEffect, createSignal, Match, Switch } from "solid-js";
import { Button } from "./button";

const initializeTheme = () => {
  let theme;
  if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
    theme = localStorage.getItem("theme") as "light" | "dark";
  } else if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
    theme = "dark";
  } else {
    theme = "light";
  }
  return theme;
};

export const ThemeToggler = () => {
  const [theme, setTheme] = createSignal<string>(initializeTheme());

  createEffect(() => {
    const root = document.documentElement;
    console.log("EFFECT", theme());
    if (theme() === "light") {
      root.classList.remove("dark");
      localStorage.setItem("theme", "light");
    } else {
      root.classList.add("dark");
      localStorage.setItem("theme", "dark");
    }
  });

  return (
    <div>
      <Button
        size="small"
        intent="ghost"
        onClick={() => setTheme((t) => (t === "light" ? "dark" : "light"))}
      >
        <Switch>
          <Match when={theme() === "light"}>{lightThemeIcon()}</Match>
          <Match when={theme() === "dark"}>{darkThemeIcon()}</Match>
        </Switch>
      </Button>
    </div>
  );
};

const lightThemeIcon = () => {
  return (
    <svg
      class="fill-current"
      width="30"
      height="30"
      viewBox="0 0 700 550"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        class="fill-current"
        d="m350 402.5c-32.488 0-63.648-12.906-86.621-35.879s-35.879-54.133-35.879-86.621 12.906-63.648 35.879-86.621 54.133-35.879 86.621-35.879 63.648 12.906 86.621 35.879 35.879 54.133 35.879 86.621-12.906 63.648-35.879 86.621-54.133 35.879-86.621 35.879zm0-210c-23.207 0-45.461 9.2188-61.871 25.629s-25.629 38.664-25.629 61.871 9.2188 45.461 25.629 61.871 38.664 25.629 61.871 25.629 45.461-9.2188 61.871-25.629 25.629-38.664 25.629-61.871-9.2188-45.461-25.629-61.871-38.664-25.629-61.871-25.629zm17.5-70v-87.5c0-6.2539-3.3359-12.031-8.75-15.156s-12.086-3.125-17.5 0-8.75 8.9023-8.75 15.156v87.5c0 6.2539 3.3359 12.031 8.75 15.156s12.086 3.125 17.5 0 8.75-8.9023 8.75-15.156zm-116.55 58.449c3.2617-3.2773 5.0898-7.7148 5.0898-12.336 0-4.625-1.8281-9.0586-5.0898-12.34l-61.773-61.949c-4.4414-4.4375-10.91-6.1719-16.973-4.5469-6.0664 1.625-10.801 6.3594-12.426 12.426-1.625 6.0625 0.10938 12.531 4.5469 16.973l61.949 61.949c3.2812 3.2578 7.7148 5.0898 12.34 5.0898 4.6211 0 9.0586-1.832 12.336-5.0898zm-40.949 99.051c0-4.6406-1.8438-9.0938-5.125-12.375s-7.7344-5.125-12.375-5.125h-87.5c-6.2539 0-12.031 3.3359-15.156 8.75s-3.125 12.086 0 17.5 8.9023 8.75 15.156 8.75h87.5c4.6406 0 9.0938-1.8438 12.375-5.125s5.125-7.7344 5.125-12.375zm-20.824 185.68 61.949-61.949c3.8594-4.5078 5.1719-10.66 3.4883-16.348-1.6797-5.6875-6.1289-10.137-11.816-11.82-5.6875-1.6797-11.84-0.36719-16.348 3.4922l-62.125 61.773c-3.7031 3.1719-5.9141 7.7461-6.1016 12.617-0.19141 4.8711 1.6641 9.6016 5.1094 13.051 3.4492 3.4453 8.1797 5.3008 13.051 5.1133 4.8711-0.19141 9.4453-2.4023 12.617-6.1055zm178.32 59.324v-87.5c0-6.2539-3.3359-12.031-8.75-15.156s-12.086-3.125-17.5 0-8.75 8.9023-8.75 15.156v87.5c0 6.2539 3.3359 12.031 8.75 15.156s12.086 3.125 17.5 0 8.75-8.9023 8.75-15.156zm168.18-59.324c3.2578-3.2812 5.0898-7.7148 5.0898-12.34 0-4.6211-1.832-9.0586-5.0898-12.336l-61.949-61.949c-4.5078-3.8594-10.66-5.1719-16.348-3.4922-5.6875 1.6836-10.137 6.1328-11.82 11.82-1.6797 5.6875-0.36719 11.84 3.4922 16.348l61.949 61.949c3.2773 3.2578 7.7148 5.0898 12.336 5.0898 4.625 0 9.0586-1.832 12.34-5.0898zm76.824-185.68c0-4.6406-1.8438-9.0938-5.125-12.375s-7.7344-5.125-12.375-5.125h-87.5c-6.2539 0-12.031 3.3359-15.156 8.75s-3.125 12.086 0 17.5 8.9023 8.75 15.156 8.75h87.5c4.6406 0 9.0938-1.8438 12.375-5.125s5.125-7.7344 5.125-12.375zm-138.77-99.051 61.949-61.949c3.8555-4.5039 5.1719-10.656 3.4883-16.348-1.6797-5.6875-6.1289-10.137-11.816-11.816-5.6914-1.6836-11.844-0.36719-16.348 3.4883l-61.949 61.949c-3.7031 3.1719-5.918 7.7461-6.1055 12.617-0.1875 4.875 1.6641 9.6016 5.1133 13.051 3.4492 3.4492 8.1758 5.3008 13.051 5.1133 4.8711-0.1875 9.4453-2.4023 12.617-6.1055z"
      />
    </svg>
  );
};

const darkThemeIcon = () => {
  return (
    <svg
      class="fill-current"
      width="30"
      height="30"
      version="1.1"
      viewBox="0 0 700 550"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        class="fill-current"
        d="m389.02 542.5c-66.863 0.09375-131.27-25.219-180.18-70.809-48.914-45.59-78.684-108.05-83.285-174.76-4.6016-66.707 16.305-132.67 58.492-184.55s102.5-85.789 168.75-94.883c5.0273-0.88281 10.191 0.47266 14.137 3.7148 3.9453 3.2422 6.2773 8.0469 6.3867 13.152 0.10938 5.1055-2.0195 10.004-5.8242 13.406-35.547 33.105-59.566 76.719-68.539 124.45-8.9727 47.738-2.4336 97.098 18.664 140.85 12.895 27.148 31.039 51.473 53.387 71.566 22.348 20.094 48.453 35.562 76.812 45.508 34.48 12.219 71.398 15.941 107.62 10.852 4.9375-0.67578 9.9258 0.78125 13.719 4.0117 3.7969 3.2305 6.0312 7.9219 6.1523 12.902 0.12109 4.9805-1.8867 9.7773-5.5195 13.188-48.902 46.051-113.6 71.605-180.78 71.398zm-83.297-476.7c-39.043 15.355-73.102 41.16-98.449 74.586-25.352 33.426-41.012 73.188-45.266 114.92-4.2539 41.734 3.0586 83.836 21.141 121.69 18.082 37.852 46.234 70 81.371 92.918 35.141 22.918 75.906 35.723 117.84 37.012 41.93 1.2891 83.406-8.9883 119.89-29.703-22.75-1.7812-45.168-6.5469-66.676-14.176-65.922-23.332-119.88-71.891-150-135-30.129-63.105-33.957-135.6-10.645-201.53 7.5742-21.496 17.93-41.91 30.801-60.723z"
      />
    </svg>
  );
};
